---
name: GCC 10
on:
        push:
        schedule:
                - cron: '0 0 * * 0'
        pull_request:
jobs:
        gcc-10:
                name: Build & Test
                runs-on: ubuntu-latest
                container: archlinux:latest
                steps:
                        - name: Setup
                          run: |
                                pacman -Sy base-devel git gtest dtc libtommath wget --noconfirm
                                wget https://aur.archlinux.org/cgit/aur.git/snapshot/libtomcrypt.tar.gz
                                mkdir /home/nobody
                                chown nobody:nobody /home/nobody
                                usermod -d /home/nobody nobody
                                tar xf libtomcrypt.tar.gz
                                chgrp nobody libtomcrypt
                                cd libtomcrypt
                                sed -i 's/check()/dont_check()/' PKGBUILD
                                sudo -u nobody gpg --recv-keys C4386A237ED43A475541B9427B2CD0DD4BCFF59B
                                sudo -u nobody makepkg
                                pacman -U --noconfirm libtomcrypt*.pkg.*
                                cd ..
                        - name: Clone
                          uses: actions/checkout@v2
                        - name: Test
                          run: make check
